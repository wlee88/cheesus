# @cheesus/api

This is the API for the Cheesus project. It is built using the NestJS framework.

## Description

- [Nest](https://github.com/nestjs/nest) framework TypeScript starter repository.
- [ts-rest](https://ts-rest.com/docs/quickstart) for validation- automatic client library typings
- Expects a postgresql database.

## Installation

```bash
$ yarn install
```

## Running the app

```bash
# development
$ yarn run start

# watch mode
$ yarn run start:dev

# production mode
$ yarn run start:prod
```

- Site is now available at `http://localhost:3000`
- Swagger docs available at `http://localhost:3000/api`

## Test

```bash
# unit tests
$ yarn run test

```
## ðŸ”ƒ How to make an API change
- Modify routes defined in  `contracts.ts` in `@cheesus/contracts` 
- Validation is handled by [zod](https://zod.dev/), and the client library is generated by [ts-rest](https://ts-rest.com/)

## Generating migrations

- Sometimes you need to run raw sql queries via migrations. To do this, you can generate a migration file by running the following command:

```bash
 yarn workspace @cheesus/api  typeorm migration:create migrations/[name-of-migration]
```
- IMPORTANT: also add the migration as an imoport  to `app.module` -> `TypeOrmModule.forRoot` -> `migrations`. This will run on app startup.

## TOFIX
- It's a pain that api only knows about contract changes after a `yarn build:contracts`. This should be fixed so it reads the direct `ts` file.
